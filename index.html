<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Web AR Exploded View</title>

  <!-- model-viewer: 最简单的 3D/AR Web 组件 -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root { --pad: 12px; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; }
    .wrap { height: 100vh; display: flex; flex-direction: column; background: #fff; }

    /* 3D/AR 区域 */
    model-viewer {
      width: 100%;
      flex: 1;
      background: #f4f4f4;
    }

    /* 底部控制条 */
    .panel {
      padding: var(--pad);
      border-top: 1px solid #e6e6e6;
      background: #ffffff;
      position: relative;
    }
    .btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 12px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    button:active { transform: scale(0.99); }

    .status {
      margin-top: 10px;
      font-size: 13px;
      color: #333;
      line-height: 1.4;
    }
    .status code {
      background: #f6f6f6;
      padding: 2px 6px;
      border-radius: 6px;
    }

    /* 右下角复制按钮（浮动） */
    .copy-btn {
      position: absolute;
      right: var(--pad);
      bottom: var(--pad);
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid #ccc;
      background: #111;
      color: #fff;
    }

    /* 小提示 */
    .hint {
      margin-top: 6px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!--
      src: 网页里显示的 3D 模型（glb）
      ios-src: iOS 进入 AR 用的模型（usdz, Quick Look）
      ar: 开启 AR 按钮
      ar-modes: iOS 用 quick-look，Android 可用 scene-viewer；webxr 有则用
    -->
    <model-viewer id="mv"
      src="assembled.glb"
      ios-src="assembled.usdz"
      camera-controls
      ar
      ar-modes="quick-look webxr scene-viewer"
      shadow-intensity="1"
      exposure="1.0"
      alt="Product model">
    </model-viewer>

    <div class="panel">
      <div class="btns">
        <button onclick="setState('Assembled', 'assembled.glb', 'assembled.usdz')">不爆炸</button>
        <button onclick="setState('Explode A', 'explode_A.glb', 'explode_A.usdz')">部分 A</button>
        <button onclick="setState('Explode B', 'explode_B.glb', 'explode_B.usdz')">部分 B</button>
        <button onclick="setState('Explode C', 'explode_C.glb', 'explode_C.usdz')">部分 C</button>
        <button onclick="setState('Explode D', 'explode_D.glb', 'explode_D.usdz')">部分 D</button>
        <button onclick="setState('Explode ALL', 'explode_all.glb', 'explode_all.usdz')">全部爆炸</button>
      </div>

      <div class="status">
        当前状态：<b id="stateName">Assembled</b><br/>
        状态文本（会被复制）：<code id="stateText"></code>
      </div>
      <div class="hint">提示：iOS/iPad 真 AR 推荐提供 .usdz 文件；网页需 HTTPS 才更稳定。</div>

      <button class="copy-btn" onclick="copyState()">复制状态</button>
    </div>
  </div>

  <script>
    const mv = document.getElementById("mv");
    const stateNameEl = document.getElementById("stateName");
    const stateTextEl = document.getElementById("stateText");

    // 你网页的“当前状态”
    const state = {
      view: "Assembled",
      glb: "assembled.glb",
      usdz: "assembled.usdz",
      ts: Date.now()
    };

    // 初始化状态文本
    updateStateText();

    function setState(viewName, glbFile, usdzFile) {
      // 切换网页3D显示模型
      mv.src = glbFile;

      // 切换 iOS AR 用的 USDZ（Quick Look）
      // 如果你暂时没有 usdz，也可以先传空字符串或同名占位
      mv.setAttribute("ios-src", usdzFile);

      // 更新状态
      state.view = viewName;
      state.glb = glbFile;
      state.usdz = usdzFile;
      state.ts = Date.now();

      stateNameEl.textContent = viewName;
      updateStateText();
    }

    function updateStateText() {
      // 这是“复制给AI”的最小状态文本（你也可以按需要加更多信息）
      const text =
`XR_VIEW=${state.view}
MODEL_GLB=${state.glb}
MODEL_USDZ=${state.usdz}`;

      stateTextEl.textContent = text;
    }

    async function copyState() {
      const text = stateTextEl.textContent;

      try {
        await navigator.clipboard.writeText(text);
        alert("已复制到剪贴板！");
      } catch (e) {
        // 某些环境可能剪贴板权限失败 -> 用 prompt 备用
        prompt("复制下面这段状态文本：", text);
      }
    }
  </script>
</body>
</html>