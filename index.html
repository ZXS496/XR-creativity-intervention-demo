<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Web AR Exploded View</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root { --pad: 12px; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif; }
    .wrap { height: 100vh; display: flex; flex-direction: column; background: #fff; }

    model-viewer {
      width: 100%;
      flex: 1;
      background: #f4f4f4;
    }

    /* ✅ 让 model-viewer 的 AR 按钮变大（关键） */
    model-viewer::part(default-ar-button) {
      width: 88px;
      height: 88px;
      border-radius: 999px;
      font-size: 16px;
      /* 可选：更显眼一点 */
      border: 2px solid #111;
    }

    /* 有些版本使用 ar-button 这个 part 名，保险起见也写上 */
    model-viewer::part(ar-button) {
      width: 88px;
      height: 88px;
      border-radius: 999px;
      font-size: 16px;
      border: 2px solid #111;
    }

    .panel {
      padding: var(--pad);
      border-top: 1px solid #e6e6e6;
      background: #ffffff;
      position: relative;
    }
    .btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 12px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    button:active { transform: scale(0.99); }

    .status {
      margin-top: 10px;
      font-size: 13px;
      color: #333;
      line-height: 1.4;
    }
    .status code {
      background: #f6f6f6;
      padding: 2px 6px;
      border-radius: 6px;
      white-space: pre-wrap;
    }

    /* ✅ 右下角复制按钮保留（可选），但你现在切换时会自动复制 */
    .copy-btn {
      position: absolute;
      right: var(--pad);
      bottom: var(--pad);
      border-radius: 999px;
      padding: 10px 14px;
      border: 1px solid #ccc;
      background: #111;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    /* 简易 toast 提示 */
    .toast {
      position: absolute;
      left: var(--pad);
      bottom: var(--pad);
      padding: 10px 12px;
      background: rgba(0,0,0,0.85);
      color: #fff;
      border-radius: 10px;
      font-size: 13px;
      display: none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <model-viewer id="mv"
      src="assembled.glb"
      ios-src="assembled.usdz"
      camera-controls
      ar
      ar-modes="quick-look webxr scene-viewer"
      shadow-intensity="1"
      exposure="1.0"
      alt="Product model">
    </model-viewer>

    <div class="panel">
      <div class="btns">
        <button onclick="setStateAndAutoCopy('Assembled', 'assembled.glb', 'assembled.usdz')">not explode</button>
        <button onclick="setStateAndAutoCopy('Explode A', 'explode_A.glb', 'explode_A.usdz')">Part A</button>
        <button onclick="setStateAndAutoCopy('Explode B', 'explode_B.glb', 'explode_B.usdz')">Part B</button>
        <button onclick="setStateAndAutoCopy('Explode ALL', 'explode_all.glb', 'explode_all.usdz')">All explode</button>
      </div>

      <div class="status">
        当前状态：<b id="stateName">Assembled</b><br/>
        状态文本（切换按钮会自动复制）：<code id="stateText"></code>
      </div>

      <!-- 可选：仍然保留手动复制按钮，防止少数浏览器自动复制失败 -->
      <button class="copy-btn" onclick="copyState(false)">复制状态</button>

      <div class="toast" id="toast">已自动复制状态</div>
    </div>
  </div>

  <script>
    const mv = document.getElementById("mv");
    const stateNameEl = document.getElementById("stateName");
    const stateTextEl = document.getElementById("stateText");
    const toastEl = document.getElementById("toast");

    const state = {
      view: "Assembled",
      glb: "assembled.glb",
      usdz: "assembled.usdz",
      ts: Date.now()
    };

    updateStateText();

    // ✅ 点击切换按钮时：切模型 + 更新state + 自动复制
    async function setStateAndAutoCopy(viewName, glbFile, usdzFile) {
      // 1) 切换网页3D模型
      mv.src = glbFile;
      // 2) 切换 iOS AR（Quick Look）模型
      mv.setAttribute("ios-src", usdzFile);

      // 3) 更新状态
      state.view = viewName;
      state.glb = glbFile;
      state.usdz = usdzFile;
      state.ts = Date.now();

      stateNameEl.textContent = viewName;
      updateStateText();

      // 4) 自动复制（静默，不弹 alert）
      await copyState(true);
    }

    function updateStateText() {
      const text =
`XR_VIEW=${state.view}
MODEL_GLB=${state.glb}
MODEL_USDZ=${state.usdz}`;

      stateTextEl.textContent = text;
    }

    function showToast(msg) {
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => {
        toastEl.style.display = "none";
      }, 1200);
    }

    // silent=true：自动复制时不弹 alert，只给 toast
    async function copyState(silent) {
      const text = stateTextEl.textContent;

      try {
        await navigator.clipboard.writeText(text);
        if (silent) showToast("已自动复制状态");
        else alert("已复制到剪贴板！");
      } catch (e) {
        // iOS/Safari 某些情况下会限制剪贴板写入 -> 兜底
        prompt("复制下面这段状态文本：", text);
      }
    }
  </script>
</body>
</html>
